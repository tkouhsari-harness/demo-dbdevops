databaseChangeLog:
  - changeSet:
      id: setup:1
      author: setup
      comment: Create DBs for each environment/infrastructure
      changes:
        - sql: 
            dbms: 'mssql'
            sql: |
              -- Define the database list
              DECLARE @databaseList TABLE (DatabaseName NVARCHAR(128));
              
              -- Add the database names to the list
              INSERT INTO @databaseList (DatabaseName)
              VALUES ('development'), ('test'), ('staging'), ('production_us'), ('production_eu'), ('production_apj_north'), ('production_af'), ('production_me'), ('production_apj_south');
              
              -- Loop through the database list and create databases if they don't exist
              DECLARE @databaseName NVARCHAR(128);
              DECLARE db_cursor CURSOR FOR SELECT DatabaseName FROM @databaseList;
              
              OPEN db_cursor;
              FETCH NEXT FROM db_cursor INTO @databaseName;
              
              WHILE @@FETCH_STATUS = 0
              BEGIN
                  -- Check if the database exists, if not, create the database
                  IF NOT EXISTS (SELECT * FROM sys.databases WHERE name = @databaseName)
                  BEGIN
                      DECLARE @createDatabaseQuery NVARCHAR(MAX);
                      SET @createDatabaseQuery = N'CREATE DATABASE ' + QUOTENAME(@databaseName);
              
                      EXEC sp_executesql @createDatabaseQuery;
                      PRINT 'Created database: ' + @databaseName;
                  END
                  ELSE
                  BEGIN
                      PRINT 'Database already exists: ' + @databaseName;
                  END
              
                  FETCH NEXT FROM db_cursor INTO @databaseName;
              END;
              
              CLOSE db_cursor;
              DEALLOCATE db_cursor;

