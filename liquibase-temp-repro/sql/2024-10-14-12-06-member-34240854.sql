-- 1) member:34240854

INSERT INTO BILLING (TRANSACTION_ID, SUBSCRIPTION_PLAN_ID,WHEN_CREATED) VALUES(84464060,89366433, '2024-09-19 11:08:45');

UPDATE STRIPE_PAYMENT_METHOD SET STATUS = 'ACTIVE' WHERE CUSTOMER_ID ='cus_Qph4F0JcDstwU4' AND ID = 1212236;

UPDATE MEMBER SET TRANSACTION_ID = NULL WHERE ID = 34240854 AND TRANSACTION_ID = 84464060;

UPDATE PAYER_PAYMENT_PROFILE SET STATUS = 'ACTIVE' WHERE MEMBER_ID = 34240854;

-- Verification Query should return one
--  SELECT 1 as EXPECTED, COUNT(*) as ACTUAL FROM BILLING b WHERE b.TRANSACTION_ID = 84464060 AND b.SUBSCRIPTION_PLAN_ID = 89366433;
EXECUTE CompareExpectedActual @sqlQuery = N'SELECT 1 as EXPECTED, COUNT(*) as ACTUAL FROM BILLING b WHERE b.TRANSACTION_ID = 84464060 AND b.SUBSCRIPTION_PLAN_ID = 89366433;';

-- Verification Query should return ACTIVE  

--  SELECT 'ACTIVE' as EXPECTED, spm.STATUS ACTUAL FROM STRIPE_PAYMENT_METHOD spm WHERE spm.CUSTOMER_ID = 'cus_Qph4F0JcDstwU4' AND ID = 1212236;


-- Verification Query should return NULL  

--  SELECT 'NULL' as EXPECTED, m.TRANSACTION_ID ACTUAL FROM MEMBER m WHERE m.ID = 34240854;


-- Verification Query should return ACTIVE  

--  SELECT 'ACTIVE' as EXPECTED, ppp.STATUS ACTUAL FROM PAYER_PAYMENT_PROFILE ppp WHERE ppp.MEMBER_ID = 34240854;
